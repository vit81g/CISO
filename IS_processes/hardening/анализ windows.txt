События ОС Windows логирование которых должно быть включено (обрати внимание на PowerShell, по умолчанию отключены):
1. журналы событий
Security Authentication & Logon
system
4624 успешный вход в систему
(тип входа 5 - psexec )
4625 уз не удалось зайти в систему
4634 Выход из системы
4648 Описание конфигурации субъекта безопасности
4688 Выполнение нового процесса
4698 Создание новой службы
4719 Изменение привилегий пользователя
4720 Создание учетной записи
4722 Изменение учетной записи
5140 Создание файла
 
2. remote  connection manager
1149 событие подключения
(IP, домен, юзер)
 
3. local session manager
21 успешный вход
22 уведомление о запуске оболочки
23 успешный выход из сеанса
24 сеанс был отключен
25 успешное переподключение сеанса
(IP, host)
 
4. Security Account actions
4720 создана учетная запись
4722 УЗ включена
 
5. windows defender (WinD)operational
5007 конфигурация WinD изменена
1116 WinD обнаружил вредоносное ПО
1117 WinD совершил действие по защите ПК
 
 
6. Windows PowerShell & PowerShell Operational
600 поставщик "Variable" (находится в состоянии Started)
4103 Выполнение модуля
4104 Создание скрипта
(обфусцированный код)
 
 
7. System
7045 Служба создана
(имя, путь, тип, тип запуска, кто запускает PSexec при запуске создает службу Psexec.svc (могут переименовать))
7030 Ошибка создания службы
7036 Статус службы изменен
 
 
8. Task Scheduler
100 начало выполнения задачи
102 задача завершена
106 задача зарегистрирована
(C:\windows\tasks - можно поискать по имени задачи
 
9. WMI Activity Operational
5861 подписка на события
полная информация об объектах
 
10. Sysmon (дополнительное ПО для сбора данных)
1 создан новый процесс
3 создано сетевое соединение
 
--
4738 уз была изменена
схожа с 4720 - имя домен атрибуты кто произвел изменения
4724 попытка сброса пароля уз
4728 - уз добавлена в глобальную группу с поддержкой безопасности
4732 - уз добавлена в локальную группу с поддержкой безопасности
уже подозрительно


$MFT 
построение таймлайн
MFTECmd.exe создаст таблицу таймлайн
Timeline Explorer используем для расшифровки созданного файла 

Prefetch
C:\windows\prefetch
идентифицирует запуск файла
парсинг prefetch файлов используем PECMD.exe
директории, дату время запуска, пути расположения

Реестр
C:\windows\System32\config - SAM, SYSTEM, SOFTWARE
C:\Windows\appcompat\Programs - AMCACHE.HVE (информация о программах которые запускались)
C:\Users\%username% - NTUSER.DAT

Registry Explorer - просмотр реестра
RegRipper - парсинг реестра

SAM - информация о новых пользователеях, даты входа, неверного ввода и сброса пароля
SYSTEM - инф. о системе хост, временная зона, конфигурации

ShimCache или AppCompatCache - база данных содержащая сведения о совместимости приложений
предоставляет таблицу с полный путь до файла которые были запущены на хосте

SOFTWARE - информация о ПО которое установлено на хосте, задачах планировщика
- LogonUI - содержит информацию о последнем пользователе который заходил в систему
- Task - информация о задачах
Ключи Run и RunOnce - файлы прописанные тут будут запускаться вне зависисмости от того какой пользователь зашел в систему

NTUSER.DAT
- OpenSavePidMRU - инф о запущенных файлах юзера
- RecentDocs - какие файлы были открыты через проводник
- TypePaths - информация о запуске через адресную строку в проводнике (переходы в папки)
- Terminal Server Client - Servers - инф о исходящих подключениях по RDP (IP или имена хостов)
UserAssist - следы часто запускаемых программ пользователем (кол-во запусков, время последнего запуска)
Важно проверять ключи закрепления Run, RunOnce, WinLogon, LogonNPRScript, UserInitMprLogonScript


Amcache.hve - содержит информацию о приложениях, запускаемых в системе, включая portable версии

Кейс атаки
таймлайн
поиск по ключевым словам
дата и время появления файла
utc и локальная временная зона !! конвертируем
смотрим что было до события
ps1 расширение скрипта





 



